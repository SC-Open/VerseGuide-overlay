<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8"/>
    <style>
        body {
            overflow: hidden;
            margin: 0px;
            height: 500px;
            width: 300px;
        }
        .hide {
            opacity: .33;
        }
        .none {
            display: none !important;
        }
        .hide.mdl-badge.mdl-badge--overlap:after {
            visibility: hidden;
        }
        .caption {
            margin-top: 8px;
            margin-bottom: 16px;
        }
    </style>
    <title>VerseGuide Status</title>

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.cyan-light_blue.min.css" />


</head>

<body>
    <div id="all">

        <span  style="opacity: .75;"><img src="../assets/location.svg" alt="Location" width="36" height="36" style="margin-right: 8px;"/><span style="border-radius: 7.8674px; font-weight: 500; font-family: Roboto; padding-left: 8px; padding-right: 8px; display: inline-block; line-height: 21.617px; height: 21.617px; background-color:rgba(0,0,0,.33); color: white;">Location</span></span>
        <div class="caption">
            <span id="location" style="width: 284px; white-space: pre-wrap; border-radius: 7.8674px; font-weight: 500; font-family: Roboto; padding-left: 8px; padding-right: 8px; display: inline-block; line-height: 21.617px; background-color:rgba(0,0,0,.33); color: white;"></span>
        </div>
        <span class="none" id="sunsetHeadline" style="opacity: .75;"><img src="../assets/sunset.svg" alt="Sunset" width="36" height="36" style="margin-right: 8px;"/><span style="border-radius: 7.8674px; font-weight: 500; font-family: Roboto; padding-left: 8px; padding-right: 8px; display: inline-block; line-height: 21.617px; height: 21.617px; background-color:rgba(0,0,0,.33); color: white;">Sunset / Sunrise</span></span>
        <div class="caption">
            <div class="none" id="sunsetCard" style="width: 284px;border-radius: 7.8674px; font-weight: 500; font-family: Roboto; background-color:rgba(0,0,0,.33); color: white; overflow: hidden;">

                <?xml version="1.0" encoding="utf-8"?>
                <!-- Generator: Adobe Illustrator 25.2.1, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
                <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                     viewBox="0 0 300 100" style="enable-background:new 0 0 300 100;" xml:space="preserve">
<style type="text/css">
	.st0{fill:none;stroke:#FFFFFF;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;}
    .st1{fill:#FFF62A;stroke:#000000;stroke-width:2;}
    .st2{opacity:0.67;enable-background:new    ;}
    .st3{fill:none;stroke:#000000;stroke-width:2;}
</style>
<g id="sunPath" transform="translate(0 0)">
    <path class="st0"
    d="M-13.8,38.8C-3.3,46.9,6,55.2,16.3,63.3c4.9,3.9,9.4,7.8,15.1,11.5c4,2.6,8.2,5.1,12.6,7.2
	c3.3,1.7,6.3,3.5,10.7,4.7c6,1.7,13.1,3.5,20.6,3.4c8.4-0.1,15.8-2.4,22.1-4.5c8.4-2.8,13.6-6.8,19.6-10.3c3.6-2.2,7.1-4.5,10.4-7
	c4.5-3.3,8.3-6.8,12.4-10.2c3.2-2.6,11.1-8.8,11.1-8.8l0,0c0,0,11.8-9.7,18-14.5c5.2-4,10-8.1,16.4-11.9c5.4-3.4,11.1-6.2,17-8.4
	c4.9-1.8,10-3.1,15.2-3.9c2.5-0.4,5.1-0.5,7.6-0.4c5,0.1,10,0.8,14.9,2c10.6,2.8,17.6,7.1,24.8,11.1c8.5,4.8,14.4,10.2,21.2,15.5
	c10.5,8.1,19.8,16.4,30.2,24.5c4.9,3.9,9.4,7.8,15.1,11.5c4.1,2.6,8.3,5,12.6,7.2c3.3,1.7,6.3,3.5,10.7,4.7c6,1.7,13.1,3.5,20.6,3.4
	c8.4-0.1,15.8-2.4,22.1-4.5c8.4-2.8,13.6-6.8,19.6-10.3c3.6-2.2,7.1-4.5,10.4-7c4.5-3.3,8.3-6.8,12.5-10.2c3.1-2.6,11-8.8,11-8.8
	l0,0v0c0,0,11.8-9.7,18-14.5c5.2-4,10-8.1,16.4-11.9c5.4-3.4,11.1-6.2,17-8.4c4.9-1.8,10-3.1,15.2-3.9c2.5-0.4,5.1-0.5,7.6-0.4
	c5,0.1,10,0.8,14.9,2c10.5,2.8,17.6,7.1,24.7,11.1c8.5,4.8,14.5,10.3,21.2,15.5c10.5,8.1,19.8,16.4,30.2,24.5
	c4.9,3.9,9.4,7.8,15.1,11.5c4,2.6,8.2,5.1,12.6,7.2c3.3,1.7,6.3,3.5,10.7,4.7c6,1.7,13.1,3.5,20.6,3.4c8.4-0.1,15.8-2.4,22.1-4.5
	c8.4-2.8,13.6-6.8,19.6-10.3c3.6-2.2,7.1-4.5,10.4-7c4.5-3.3,8.3-6.8,12.5-10.2c3.2-2.6,11.1-8.8,11.1-8.8l0,0c0,0,11.8-9.7,18-14.5
	c5.2-4,10-8.1,16.4-11.9c5.4-3.4,11.1-6.2,17-8.4c4.9-1.8,10-3.1,15.2-3.9c2.5-0.4,5.1-0.5,7.6-0.4c5,0.1,10,0.8,14.9,2
	c10.6,2.8,17.6,7.1,24.8,11.1c8.5,4.8,14.5,10.2,21.2,15.5c10.5,8.1,19.8,16.4,30.2,24.5c4.9,3.9,9.4,7.8,15.1,11.5
	c4.1,2.6,8.3,5,12.6,7.2c3.3,1.7,6.3,3.5,10.7,4.7c6,1.7,13.1,3.5,20.6,3.4c8.4-0.1,15.8-2.4,22.1-4.5c8.4-2.8,13.6-6.8,19.6-10.3
	c3.6-2.2,7.1-4.5,10.4-7c4.5-3.3,8.3-6.8,12.4-10.2c3.2-2.6,11.1-8.8,11.1-8.8l0,0"/>
</g>
                    <circle id="sun" class="st1" cx="150" cy="50" r="7.5"/>
                    <rect id="horizon" y="50" class="st2" width="300" height="50"/>
                    <line id="horizonLine" class="st3" x1="0" y1="50" x2="300" y2="50"/>
</svg>


                <span id="sunset" style=" white-space: pre-wrap; padding-left: 8px; padding-right: 8px; display: inline-block; line-height: 21.617px; "></span>

        </div>
    </div>
    <script>

        const all = document.getElementById('all')
        const locationElement = document.getElementById('location')
        const sunsetHeadline = document.getElementById('sunsetHeadline')
        const sunsetElement = document.getElementById('sunsetCard')
        const sunsetText = document.getElementById('sunset')
        let horizonPosition = 50
        let horizonHeight = 100 - horizonPosition
        let sunPosition = 50
        let sunPath = 0

        const {
            ipcRenderer, remote
        } = window.require('electron')

        ipcRenderer.on("hide", (event, isHidden) => {

            if (isHidden) {
                all.classList.add("none");
            } else {
                all.classList.remove("none");
            }

        })

        ipcRenderer.on("clipboard", (event, {timestamp, coordinates}) => {
            let whereAmI = getLocalXYZ(coordinates, timestamp);
            if (whereAmI) {
                try {

                    if (whereAmI.error) {
                        locationElement.innerText = 'could not compute'
                        sunsetText.innerText = ''
                    } else if (!whereAmI.body) {
                        if (whereAmI.coordinates && whereAmI.coordinates[0]) {
                            locationElement.innerText = 'in space\nx: ' + whereAmI.coordinates[0] + '\ny: ' + whereAmI.coordinates[1] + '\nz: ' + whereAmI.coordinates[2]
                            sunsetText.innerText = ''
                        } else {
                            locationElement.innerText = 'no coordinates available'
                            sunsetText.innerText = ''
                        }
                    } else {
                        if (whereAmI.location) {
                            locationElement.innerText = whereAmI.body + "\nLatitude: " + whereAmI.location.lat + "\nLongitude: " + whereAmI.location.long + "\nAltitude: " + whereAmI.location.alt+ "\n(x: " + whereAmI.location.x + ", y: " + whereAmI.location.y + ", z: " + whereAmI.location.z + ")"
                        } else {
                            locationElement.innerText = whereAmI.body
                        }

                        if (whereAmI.daytime) {

                            //calculate horizon line (10...90 height, horizon value is -1 ... 1)
                            horizonPosition = 50 + whereAmI.daytime.horizon * 40
                            horizonHeight = 100 - horizonPosition

                            if (!whereAmI.daytime.dayRaw) {
                                horizonPosition = 0
                                horizonHeight = 100
                            } else if (!whereAmI.daytime.nightRaw) {
                                horizonPosition = 100
                                horizonHeight = 0
                            }

                            document.getElementById('horizon').setAttribute("y", horizonPosition);
                            document.getElementById('horizon').setAttribute("height", horizonHeight);
                            document.getElementById('horizonLine').setAttribute("y1", horizonPosition);
                            document.getElementById('horizonLine').setAttribute("y2", horizonPosition);

                            //calculate sun position (Sin(whereAmI.daytime.sun) is -1 ... 1
                            sunPosition = 50 - Math.sin(whereAmI.daytime.sun) * 40
                            document.getElementById('sun').setAttribute("cy", sunPosition);

                            //calculate sun path (whereAmI.daytime.sun is 0 ... 2*pi - shifts sine by 0 ... 300px
                            sunPath = -1 * whereAmI.daytime.sun / 2 / Math.PI * 300
                            document.getElementById('sunPath').setAttribute("transform", "translate(" + sunPath + " 0)");

                            sunsetText.innerText = "Sunset in: " + whereAmI.daytime.sunset + "\nSunrise in: " + whereAmI.daytime.sunrise + "\nDay duration: " + whereAmI.daytime.day + "\nNight duration: " + whereAmI.daytime.night + "\nSun angle: " + whereAmI.daytime.sun + "\nHorizon: " + whereAmI.daytime.horizon
                        } else {
                            sunsetText.innerText = ''
                        }

                    }

                } catch (e) {
                    locationElement.innerText = 'could not parse: ' + e
                    sunsetText.innerText = ''
                }

            } else {
                locationElement.innerText = 'unknown error'
                sunsetText.innerText = ''
            }

            if (sunsetText.innerText === '') {
                sunsetHeadline.classList.add("none");
                sunsetElement.classList.add("none");
            } else {
                sunsetHeadline.classList.remove("none");
                sunsetElement.classList.remove("none");
            }




        })

        //this opens the main overlay menu
        /*
        const button = document.getElementById('button')
        button.addEventListener('click', () => {
            ipcRenderer.send('startIntercept')
        })
        */

    </script>

    <script src="location.js"></script>
</body>

</html>
